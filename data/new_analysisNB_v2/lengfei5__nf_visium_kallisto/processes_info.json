{
    "starting": {
        "name_process": "starting",
        "string_process": "\nprocess starting{\n\n    script:\n    \"\"\"\n    echo Pseudoalignment doesn't work as a first step, so we'll have this here.\n\n    \"\"\"\n}",
        "nb_lignes_process": 7,
        "string_script": "    \"\"\"\n    echo Pseudoalignment doesn't work as a first step, so we'll have this here.\n\n    \"\"\"",
        "nb_lignes_script": 3,
        "language_script": "bash",
        "tools": [],
        "tools_url": [],
        "tools_dico": [],
        "inputs": [],
        "nb_inputs": 0,
        "outputs": [],
        "nb_outputs": 0,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [],
        "when": "",
        "stub": ""
    },
    "index": {
        "name_process": "index",
        "string_process": "\nprocess index {\n\n                                                                       \n                                                             \n    storeDir transcriptome_file.getParent()\n\n    input:\n    file transcriptome_file\n\n    output:\n    file params.transindex into transcriptome_index\n\n    script:\n    \"\"\"\n    kallisto index -i ${params.transindex} -k 31 --make-unique ${transcriptome_file}\n\n    \"\"\"\n}",
        "nb_lignes_process": 17,
        "string_script": "    \"\"\"\n    kallisto index -i ${params.transindex} -k 31 --make-unique ${transcriptome_file}\n\n    \"\"\"",
        "nb_lignes_script": 3,
        "language_script": "bash",
        "tools": [
            "kallisto"
        ],
        "tools_url": [
            "https://bio.tools/kallisto"
        ],
        "tools_dico": [
            {
                "name": "kallisto",
                "uri": "https://bio.tools/kallisto",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3308",
                            "term": "Transcriptomics"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profiling"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Functional profiling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profile construction"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Feature expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene transcription profiling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression quantification"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profile generation"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "A program for quantifying abundances of transcripts from RNA-Seq data, or more generally of target sequences using high-throughput sequencing reads. It is based on the novel idea of pseudoalignment for rapidly determining the compatibility of reads with targets, without the need for alignment.",
                "homepage": "https://pachterlab.github.io/kallisto/about.html"
            }
        ],
        "inputs": [
            "transcriptome_file"
        ],
        "nb_inputs": 1,
        "outputs": [
            "transcriptome_index"
        ],
        "nb_outputs": 1,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir transcriptome_file.getParent()"
        ],
        "when": "",
        "stub": ""
    },
    "pseudoalPlate": {
        "name_process": "pseudoalPlate",
        "string_process": "\nprocess pseudoalPlate {\n    storeDir params.outdir\n\n    input:\n    file index from transcriptome_index\n    file batchkal from batch_kal.collect()\n\n    output:\n    file params.samplename into kallisto_pseudo\n\n    when: params.protocol=='plate'\n\n    script:\n    \"\"\"\n    ml load kallisto/0.46.0-foss-2018b\n    kallisto pseudo -t 16 --quant \\\\\n        -i $index \\\\\n        -o ${params.samplename} \\\\\n        -b $batchkal\n\n    \"\"\"\n}",
        "nb_lignes_process": 21,
        "string_script": "    \"\"\"\n    ml load kallisto/0.46.0-foss-2018b\n    kallisto pseudo -t 16 --quant \\\\\n        -i $index \\\\\n        -o ${params.samplename} \\\\\n        -b $batchkal\n\n    \"\"\"",
        "nb_lignes_script": 7,
        "language_script": "bash",
        "tools": [
            "MLC",
            "kallisto"
        ],
        "tools_url": [
            "https://bio.tools/MLC",
            "https://bio.tools/kallisto"
        ],
        "tools_dico": [
            {
                "name": "MLC",
                "uri": "https://bio.tools/MLC",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarray experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarrays"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Expression correlation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted correlation network analysis"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Over-representation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Co-expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "WGCNA"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted gene co-expression network analysis"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Metric Learning on Expression Data for Gene Function Prediction.",
                "homepage": "http://www.github.com/stamakro/MLC"
            },
            {
                "name": "kallisto",
                "uri": "https://bio.tools/kallisto",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3308",
                            "term": "Transcriptomics"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profiling"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Functional profiling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profile construction"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Feature expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene transcription profiling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression quantification"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profile generation"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "A program for quantifying abundances of transcripts from RNA-Seq data, or more generally of target sequences using high-throughput sequencing reads. It is based on the novel idea of pseudoalignment for rapidly determining the compatibility of reads with targets, without the need for alignment.",
                "homepage": "https://pachterlab.github.io/kallisto/about.html"
            }
        ],
        "inputs": [
            "transcriptome_index",
            "batch_kal"
        ],
        "nb_inputs": 2,
        "outputs": [
            "kallisto_pseudo"
        ],
        "nb_outputs": 1,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir params.outdir"
        ],
        "when": "",
        "stub": ""
    },
    "pseudoal": {
        "name_process": "pseudoal",
        "string_process": "\nprocess pseudoal {\n\n                                                          \n    storeDir params.outdir\n\n    input:\n    file index from transcriptome_index\n    file reads from read_files_kallisto.collect()\n\n    output:\n    file params.samplename into kallisto_bus_to_sort\n    file \"${params.samplename}/output.bus\"\n    file \"${params.samplename}/matrix.ec\"\n    file \"${params.samplename}/transcripts.txt\"\n\n    when: params.protocol!='plate'\n\n    script:\n    if(params.protocol=='visiumv1')\n        \"\"\"\n        ml load kallisto/0.46.0-foss-2018b\n        kallisto bus \\\\\n            -i $index \\\\\n            -o ${params.samplename} \\\\\n            -x 0,0,16:0,16,28:1,0,0 \\\\\n            -t 12 \\\\\n            $reads\n\n        \"\"\"\n    else\n        \"\"\"\n        ml load kallisto/0.46.0-foss-2018b\n        kallisto bus \\\\\n            -i $index \\\\\n            -o ${params.samplename} \\\\\n            -x ${params.protocol} \\\\\n            -t 12 \\\\\n            $reads\n\n        \"\"\"\n}",
        "nb_lignes_process": 40,
        "string_script": "    if(params.protocol=='visiumv1')\n        \"\"\"\n        ml load kallisto/0.46.0-foss-2018b\n        kallisto bus \\\\\n            -i $index \\\\\n            -o ${params.samplename} \\\\\n            -x 0,0,16:0,16,28:1,0,0 \\\\\n            -t 12 \\\\\n            $reads\n\n        \"\"\"\n    else\n        \"\"\"\n        ml load kallisto/0.46.0-foss-2018b\n        kallisto bus \\\\\n            -i $index \\\\\n            -o ${params.samplename} \\\\\n            -x ${params.protocol} \\\\\n            -t 12 \\\\\n            $reads\n\n        \"\"\"",
        "nb_lignes_script": 21,
        "language_script": "bash",
        "tools": [
            "MLC",
            "kallisto"
        ],
        "tools_url": [
            "https://bio.tools/MLC",
            "https://bio.tools/kallisto"
        ],
        "tools_dico": [
            {
                "name": "MLC",
                "uri": "https://bio.tools/MLC",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarray experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarrays"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Expression correlation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted correlation network analysis"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Over-representation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Co-expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "WGCNA"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted gene co-expression network analysis"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Metric Learning on Expression Data for Gene Function Prediction.",
                "homepage": "http://www.github.com/stamakro/MLC"
            },
            {
                "name": "kallisto",
                "uri": "https://bio.tools/kallisto",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3308",
                            "term": "Transcriptomics"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profiling"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Functional profiling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profile construction"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Feature expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene transcription profiling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression quantification"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0314",
                                    "term": "Gene expression profile generation"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "A program for quantifying abundances of transcripts from RNA-Seq data, or more generally of target sequences using high-throughput sequencing reads. It is based on the novel idea of pseudoalignment for rapidly determining the compatibility of reads with targets, without the need for alignment.",
                "homepage": "https://pachterlab.github.io/kallisto/about.html"
            }
        ],
        "inputs": [
            "transcriptome_index",
            "read_files_kallisto"
        ],
        "nb_inputs": 2,
        "outputs": [
            "kallisto_bus_to_sort"
        ],
        "nb_outputs": 1,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir params.outdir"
        ],
        "when": "",
        "stub": ""
    },
    "corrsort": {
        "name_process": "corrsort",
        "string_process": "\nprocess corrsort {\n\n                                            \n    storeDir params.outdir\n\n    input:\n    file outbus from kallisto_bus_to_sort\n    file white from bc_wl_kal.collect()\n\n    output:\n    file \"${outbus}/output.cor.sort.bus\"\n    file outbus into kal_sort_to_count\n    file outbus into kal_sort_to_umi\n\n    when: params.protocol!='plate'\n\n    script:\n    \"\"\"\n    ml load bustools/0.40.0-foss-2018b\n    bustools correct -w $white -o ${outbus}/output.cor.bus ${outbus}/output.bus\n    bustools sort -o ${outbus}/output.cor.sort.bus -t 8 ${outbus}/output.cor.bus\n\n    \"\"\"\n}",
        "nb_lignes_process": 23,
        "string_script": "    \"\"\"\n    ml load bustools/0.40.0-foss-2018b\n    bustools correct -w $white -o ${outbus}/output.cor.bus ${outbus}/output.bus\n    bustools sort -o ${outbus}/output.cor.sort.bus -t 8 ${outbus}/output.cor.bus\n\n    \"\"\"",
        "nb_lignes_script": 5,
        "language_script": "bash",
        "tools": [
            "MLC",
            "BUStools"
        ],
        "tools_url": [
            "https://bio.tools/MLC",
            "https://bio.tools/BUStools"
        ],
        "tools_dico": [
            {
                "name": "MLC",
                "uri": "https://bio.tools/MLC",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarray experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarrays"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Expression correlation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted correlation network analysis"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Over-representation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Co-expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "WGCNA"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted gene co-expression network analysis"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Metric Learning on Expression Data for Gene Function Prediction.",
                "homepage": "http://www.github.com/stamakro/MLC"
            },
            {
                "name": "BUStools",
                "uri": "https://bio.tools/BUStools",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3512",
                            "term": "Gene transcripts"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3308",
                            "term": "Transcriptomics"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3512",
                            "term": "mRNA features"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3680",
                                    "term": "RNA-Seq analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3800",
                                    "term": "RNA-Seq quantification"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "DNA barcoding"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3800",
                                    "term": "RNA-Seq quantitation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "Sample barcoding"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "Community profiling"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "> COMMON LINK WITH (PUB. & NAME DIFFERENT) bio.tools/pymzml (GITHUB.COM) | > CORRECT NAME OF TOOL COULD ALSO BE 'BUStools suite', 'BUStools suite tools', 'BUS' (bio.tools/bus), 'kallisto' (bio.tools/kallisto) | The Barcode, UMI, Set format and BUStools | Materials associated with the manuscript \"The Barcode, UMI, Set format and BUStools\" by P\u00e1ll Melsted, Vasilis Ntranos and Lior Pachter | Tools for working with BUS files | R vignettes for processing BUS format single-cell RNA-seq files",
                "homepage": "http://BUStools.github.io/"
            }
        ],
        "inputs": [
            "kallisto_bus_to_sort",
            "bc_wl_kal"
        ],
        "nb_inputs": 2,
        "outputs": [
            "kal_sort_to_count",
            "kal_sort_to_umi"
        ],
        "nb_outputs": 2,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir params.outdir"
        ],
        "when": "",
        "stub": ""
    },
    "umicounts": {
        "name_process": "umicounts",
        "string_process": "\nprocess umicounts {\n\n    storeDir params.outdir\n\n    input:\n    file outbus from kal_sort_to_umi\n\n    output:\n    file \"${outbus}/umicount.txt\" into kallisto_umic\n\n    when: params.protocol!='plate'\n\n    script:\n    \"\"\"\n    ml load bustools/0.40.0-foss-2018b\n    bustools text -o ${outbus}/umicount.txt ${outbus}/output.cor.sort.bus\n\n    \"\"\"\n}",
        "nb_lignes_process": 18,
        "string_script": "    \"\"\"\n    ml load bustools/0.40.0-foss-2018b\n    bustools text -o ${outbus}/umicount.txt ${outbus}/output.cor.sort.bus\n\n    \"\"\"",
        "nb_lignes_script": 4,
        "language_script": "bash",
        "tools": [
            "MLC",
            "BUStools"
        ],
        "tools_url": [
            "https://bio.tools/MLC",
            "https://bio.tools/BUStools"
        ],
        "tools_dico": [
            {
                "name": "MLC",
                "uri": "https://bio.tools/MLC",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarray experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarrays"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Expression correlation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted correlation network analysis"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Over-representation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Co-expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "WGCNA"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted gene co-expression network analysis"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Metric Learning on Expression Data for Gene Function Prediction.",
                "homepage": "http://www.github.com/stamakro/MLC"
            },
            {
                "name": "BUStools",
                "uri": "https://bio.tools/BUStools",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3512",
                            "term": "Gene transcripts"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3308",
                            "term": "Transcriptomics"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3512",
                            "term": "mRNA features"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3680",
                                    "term": "RNA-Seq analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3800",
                                    "term": "RNA-Seq quantification"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "DNA barcoding"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3800",
                                    "term": "RNA-Seq quantitation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "Sample barcoding"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "Community profiling"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "> COMMON LINK WITH (PUB. & NAME DIFFERENT) bio.tools/pymzml (GITHUB.COM) | > CORRECT NAME OF TOOL COULD ALSO BE 'BUStools suite', 'BUStools suite tools', 'BUS' (bio.tools/bus), 'kallisto' (bio.tools/kallisto) | The Barcode, UMI, Set format and BUStools | Materials associated with the manuscript \"The Barcode, UMI, Set format and BUStools\" by P\u00e1ll Melsted, Vasilis Ntranos and Lior Pachter | Tools for working with BUS files | R vignettes for processing BUS format single-cell RNA-seq files",
                "homepage": "http://BUStools.github.io/"
            }
        ],
        "inputs": [
            "kal_sort_to_umi"
        ],
        "nb_inputs": 1,
        "outputs": [
            "kallisto_umic"
        ],
        "nb_outputs": 1,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir params.outdir"
        ],
        "when": "",
        "stub": ""
    },
    "countbus": {
        "name_process": "countbus",
        "string_process": "\nprocess countbus {\n                                            \n    storeDir params.outdir\n\n    input:\n    file outbus from kal_sort_to_count\n    file t2g from t2g_kal.collect()\n\n    output:\n    file \"${outbus}/genecounts.mtx\"\n    file outbus into kallisto_count\n\n    when: params.protocol!='plate'\n\n    script:\n    \"\"\"\n    ml load bustools/0.40.0-foss-2018b\n    bustools count --em -t ${outbus}/transcripts.txt -e ${outbus}/matrix.ec -g $t2g --genecounts -o ${outbus}/genecounts ${outbus}/output.cor.sort.bus\n\n    \"\"\"\n}",
        "nb_lignes_process": 20,
        "string_script": "    \"\"\"\n    ml load bustools/0.40.0-foss-2018b\n    bustools count --em -t ${outbus}/transcripts.txt -e ${outbus}/matrix.ec -g $t2g --genecounts -o ${outbus}/genecounts ${outbus}/output.cor.sort.bus\n\n    \"\"\"",
        "nb_lignes_script": 4,
        "language_script": "bash",
        "tools": [
            "MLC",
            "BUStools"
        ],
        "tools_url": [
            "https://bio.tools/MLC",
            "https://bio.tools/BUStools"
        ],
        "tools_dico": [
            {
                "name": "MLC",
                "uri": "https://bio.tools/MLC",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarray experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarrays"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Expression correlation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted correlation network analysis"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Over-representation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Co-expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "WGCNA"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted gene co-expression network analysis"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Metric Learning on Expression Data for Gene Function Prediction.",
                "homepage": "http://www.github.com/stamakro/MLC"
            },
            {
                "name": "BUStools",
                "uri": "https://bio.tools/BUStools",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3512",
                            "term": "Gene transcripts"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3308",
                            "term": "Transcriptomics"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3512",
                            "term": "mRNA features"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3680",
                                    "term": "RNA-Seq analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3800",
                                    "term": "RNA-Seq quantification"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "DNA barcoding"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3800",
                                    "term": "RNA-Seq quantitation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "Sample barcoding"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3200",
                                    "term": "Community profiling"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "> COMMON LINK WITH (PUB. & NAME DIFFERENT) bio.tools/pymzml (GITHUB.COM) | > CORRECT NAME OF TOOL COULD ALSO BE 'BUStools suite', 'BUStools suite tools', 'BUS' (bio.tools/bus), 'kallisto' (bio.tools/kallisto) | The Barcode, UMI, Set format and BUStools | Materials associated with the manuscript \"The Barcode, UMI, Set format and BUStools\" by P\u00e1ll Melsted, Vasilis Ntranos and Lior Pachter | Tools for working with BUS files | R vignettes for processing BUS format single-cell RNA-seq files",
                "homepage": "http://BUStools.github.io/"
            }
        ],
        "inputs": [
            "kal_sort_to_count",
            "t2g_kal"
        ],
        "nb_inputs": 2,
        "outputs": [
            "kallisto_count"
        ],
        "nb_outputs": 1,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir params.outdir"
        ],
        "when": "",
        "stub": ""
    },
    "getTissue": {
        "name_process": "getTissue",
        "string_process": "\nprocess getTissue {\n    storeDir \"${params.outdir}/${params.samplename}\"\n\n            \n                                            \n                                          \n\n    output:\n    file \"mock/outs/spatial/aligned_fiducials.jpg\"\n    file \"mock/outs/spatial/scalefactors_json.json\"\n    file \"mock/outs/spatial/tissue_lowres_image.png\"\n    file \"mock/outs/spatial/detected_tissue_image.jpg\"\n    file \"mock/outs/spatial/tissue_hires_image.png\"\n    file \"mock/outs/spatial/tissue_positions_list.csv\"\n\n    when: params.protocol=='visiumv1'\n\n    script:\n    \"\"\"\n    ml load spaceranger/1.3.0-gcccore-7.3.0\n    spaceranger count \\\n      --id=mock \\\n      --fastqs=${params.mock} \\\n      --transcriptome=${params.refhs} \\\n      --image=${params.imagef} \\\n      --slide=${params.images} \\\n      --area=${params.imagear} \\\n      --loupe-alignment=${params.imageal} \\\n      --localcores=6\n\n    \"\"\"\n\n}",
        "nb_lignes_process": 32,
        "string_script": "    \"\"\"\n    ml load spaceranger/1.3.0-gcccore-7.3.0\n    spaceranger count \\\n      --id=mock \\\n      --fastqs=${params.mock} \\\n      --transcriptome=${params.refhs} \\\n      --image=${params.imagef} \\\n      --slide=${params.images} \\\n      --area=${params.imagear} \\\n      --loupe-alignment=${params.imageal} \\\n      --localcores=6\n\n    \"\"\"",
        "nb_lignes_script": 12,
        "language_script": "bash",
        "tools": [
            "MLC"
        ],
        "tools_url": [
            "https://bio.tools/MLC"
        ],
        "tools_dico": [
            {
                "name": "MLC",
                "uri": "https://bio.tools/MLC",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarray experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarrays"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Expression correlation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted correlation network analysis"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Over-representation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Co-expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "WGCNA"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted gene co-expression network analysis"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Metric Learning on Expression Data for Gene Function Prediction.",
                "homepage": "http://www.github.com/stamakro/MLC"
            }
        ],
        "inputs": [],
        "nb_inputs": 0,
        "outputs": [],
        "nb_outputs": 0,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir \"${params.outdir}/${params.samplename}\""
        ],
        "when": "",
        "stub": ""
    },
    "makeSeuratPlate": {
        "name_process": "makeSeuratPlate",
        "string_process": "\nprocess makeSeuratPlate {\n\n    storeDir \"${params.outdir}/${params.samplename}\"\n\n    input:\n    file outps from kallisto_pseudo\n    file t2g from t2g_plate.collect()\n\n    output:\n    file \"${params.samplename}_srat.RDS\"\n\n    when: params.protocol=='plate'\n\n    script:\n    \"\"\"\n    #!/usr/local/bin/Rscript --vanilla\n\n    library(Seurat)\n\n    # read in data\n    topdir = \"${outps}\" # source dir\n    exp = Matrix::readMM(paste0(topdir, \"/matrix.abundance.mtx\")) #read matrix\n    bc = read.csv(paste0(topdir, \"/matrix.cells\"), header = F, stringsAsFactors = F)\n    g = read.csv(paste0(topdir, \"/transcripts.txt\"), header = F, stringsAsFactors = F)\n    dimnames(exp) = list(paste0(bc\\$V1,\"-1\"),g\\$V1) # number added because of seurat format for barcodes\n    count.data = Matrix::t(exp)\n\n    # summarise transcripts by gene name\n    t2g = read.table(\"$t2g\", header = F, stringsAsFactors = F, sep = \"\\t\")\n    exp_gene = rowsum(as.matrix(count.data), t2g\\$V2)\n\n    # create Seurat object\n    srat = CreateSeuratObject(counts = exp_gene)\n\n    # get MT% (genes curated from NCBI chrMT genes)\n    mtgenes = c(\"COX1\", \"COX2\", \"COX3\", \"ATP6\", \"ND1\", \"ND5\", \"CYTB\", \"ND2\", \"ND4\",\n                \"ATP8\", \"MT-CO1\", \"COI\", \"LOC9829747\")\n    mtgenes = c(mtgenes, paste0(\"MT\", mtgenes), paste0(\"MT-\", mtgenes))\n    mtgenes = mtgenes[mtgenes %in% rownames(exp_gene)]\n    srat = PercentageFeatureSet(srat, col.name = \"percent.mt\", assay = \"RNA\",\n                                features = mtgenes)\n\n    saveRDS(srat, file = \"${params.samplename}_srat.RDS\")\n    \"\"\"\n\n}",
        "nb_lignes_process": 45,
        "string_script": "    \"\"\"\n    #!/usr/local/bin/Rscript --vanilla\n\n    library(Seurat)\n\n    # read in data\n    topdir = \"${outps}\" # source dir\n    exp = Matrix::readMM(paste0(topdir, \"/matrix.abundance.mtx\")) #read matrix\n    bc = read.csv(paste0(topdir, \"/matrix.cells\"), header = F, stringsAsFactors = F)\n    g = read.csv(paste0(topdir, \"/transcripts.txt\"), header = F, stringsAsFactors = F)\n    dimnames(exp) = list(paste0(bc\\$V1,\"-1\"),g\\$V1) # number added because of seurat format for barcodes\n    count.data = Matrix::t(exp)\n\n    # summarise transcripts by gene name\n    t2g = read.table(\"$t2g\", header = F, stringsAsFactors = F, sep = \"\\t\")\n    exp_gene = rowsum(as.matrix(count.data), t2g\\$V2)\n\n    # create Seurat object\n    srat = CreateSeuratObject(counts = exp_gene)\n\n    # get MT% (genes curated from NCBI chrMT genes)\n    mtgenes = c(\"COX1\", \"COX2\", \"COX3\", \"ATP6\", \"ND1\", \"ND5\", \"CYTB\", \"ND2\", \"ND4\",\n                \"ATP8\", \"MT-CO1\", \"COI\", \"LOC9829747\")\n    mtgenes = c(mtgenes, paste0(\"MT\", mtgenes), paste0(\"MT-\", mtgenes))\n    mtgenes = mtgenes[mtgenes %in% rownames(exp_gene)]\n    srat = PercentageFeatureSet(srat, col.name = \"percent.mt\", assay = \"RNA\",\n                                features = mtgenes)\n\n    saveRDS(srat, file = \"${params.samplename}_srat.RDS\")\n    \"\"\"",
        "nb_lignes_script": 29,
        "language_script": "--vanilla",
        "tools": [],
        "tools_url": [],
        "tools_dico": [],
        "inputs": [
            "kallisto_pseudo",
            "t2g_plate"
        ],
        "nb_inputs": 2,
        "outputs": [],
        "nb_outputs": 0,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir \"${params.outdir}/${params.samplename}\""
        ],
        "when": "",
        "stub": ""
    },
    "makeSeurat10x": {
        "name_process": "makeSeurat10x",
        "string_process": "\nprocess makeSeurat10x {\n\n    storeDir \"${params.outdir}/${params.samplename}\"\n\n    input:\n    file outbus from kallisto_count\n    file umic from kallisto_umic.collect()\n\n    output:\n    file \"${params.samplename}_UMIrank.pdf\"\n    file \"${params.samplename}_UMIduplication.pdf\"\n    file \"${params.samplename}_srat.RDS\"\n\n    when: params.protocol=='10xv3' || params.protocol=='10xv2'\n\n    script:\n    \"\"\"\n    #!/usr/local/bin/Rscript --vanilla\n\n    library(Seurat)\n    library(DropletUtils)\n\n    # read in data\n    topdir = \"${outbus}\" # source dir\n    exp = Matrix::readMM(paste0(topdir, \"/genecounts.mtx\")) #read matrix\n    bc = read.csv(paste0(topdir, \"/genecounts.barcodes.txt\"), header = F, stringsAsFactors = F)\n    g = read.csv(paste0(topdir, \"/genecounts.genes.txt\"), header = F, stringsAsFactors = F)\n    dimnames(exp) = list(paste0(bc\\$V1,\"-1\"),g\\$V1) # number added because of seurat format for barcodes\n    count.data = Matrix::t(exp)\n\n    # get emptyDrops and default cutoff cell estimates\n    iscell_dd = defaultDrops(count.data, expected = 5000)\n    eout = emptyDrops(count.data, lower = 200)\n    eout\\$FDR[is.na(eout\\$FDR)] = 1\n    iscell_ed = eout\\$FDR<=0.01\n    meta = data.frame(row.names = paste0(bc\\$V1,\"-1\"),\n                      iscell_dd = iscell_dd, iscell_ed = iscell_ed)\n\n    # plot rankings for number of UMI\n    br.out <- barcodeRanks(count.data)\n    pdf(\"${params.samplename}_UMIrank.pdf\", height = 5, width = 5, useDingbats = F)\n    plot(br.out\\$rank, br.out\\$total, log=\"xy\", xlab=\"Rank\", ylab=\"Total\")\n    o <- order(br.out\\$rank)\n    lines(br.out\\$rank[o], br.out\\$fitted[o], col=\"red\")\n    abline(h=metadata(br.out)\\$knee, col=\"dodgerblue\", lty=2)\n    abline(h=metadata(br.out)\\$inflection, col=\"forestgreen\", lty=2)\n    legend(\"bottomleft\", lty=2, col=c(\"dodgerblue\", \"forestgreen\"),\n        legend=c(\"knee\", \"inflection\"))\n    dev.off()\n\n    # UMI duplication\n    umi = read.table(\"${umic}\", sep = \"\\t\", header = F, stringsAsFactors = F)\n    sumUMI = c()\n    sumi = sum(umi\\$V4)\n    for(i in 0:250){ sumUMI = c(sumUMI, sum(umi\\$V4[umi\\$V4>i])/sumi) }\n    pdf(\"${params.samplename}_UMIduplication.pdf\", height = 3.5, width = 7, useDingbats = F)\n    par(mfrow = c(1,2))\n    plot(sumUMI, ylim = c(0,1), pch = 20, col = \"grey30\", ylab = \"% of total reads\",\n         xlab = \"More than xx UMI\", main = \"${params.samplename}\")\n    diffUMI = sumUMI[-length(sumUMI)] - sumUMI[-1]\n    plot(diffUMI, ylim = c(0,0.2), pch = 20, col = \"grey30\", ylab = \"Change in % of total reads\",\n         xlab = \"More than xx UMI\", main = \"${params.samplename}\")\n    dev.off()\n\n    # create Seurat object\n    ## we're only keeping what might potentially be a cell (by DD or ED)\n    srat = CreateSeuratObject(counts = count.data[,iscell_dd | iscell_ed],\n                              meta.data = meta[iscell_dd | iscell_ed,])\n    amb_prop = estimateAmbience(count.data)[rownames(srat@assays\\$RNA@meta.features)]\n    srat@assays\\$RNA@meta.features = data.frame(row.names = rownames(srat@assays\\$RNA@meta.features),\n                                                \"ambient_prop\" = amb_prop)\n\n    # get MT% (genes curated from NCBI chrMT genes)\n    mtgenes = c(\"COX1\", \"COX2\", \"COX3\", \"ATP6\", \"ND1\", \"ND5\", \"CYTB\", \"ND2\", \"ND4\",\n                \"ATP8\", \"MT-CO1\", \"COI\", \"LOC9829747\")\n    mtgenes = c(mtgenes, paste0(\"MT\", mtgenes), paste0(\"MT-\", mtgenes))\n    mtgenes = mtgenes[mtgenes %in% g[,1]]\n    srat = PercentageFeatureSet(srat, col.name = \"percent.mt\", assay = \"RNA\",\n                                features = mtgenes)\n\n    saveRDS(srat, file = \"${params.samplename}_srat.RDS\")\n\n    \"\"\"\n\n}",
        "nb_lignes_process": 84,
        "string_script": "    \"\"\"\n    #!/usr/local/bin/Rscript --vanilla\n\n    library(Seurat)\n    library(DropletUtils)\n\n    # read in data\n    topdir = \"${outbus}\" # source dir\n    exp = Matrix::readMM(paste0(topdir, \"/genecounts.mtx\")) #read matrix\n    bc = read.csv(paste0(topdir, \"/genecounts.barcodes.txt\"), header = F, stringsAsFactors = F)\n    g = read.csv(paste0(topdir, \"/genecounts.genes.txt\"), header = F, stringsAsFactors = F)\n    dimnames(exp) = list(paste0(bc\\$V1,\"-1\"),g\\$V1) # number added because of seurat format for barcodes\n    count.data = Matrix::t(exp)\n\n    # get emptyDrops and default cutoff cell estimates\n    iscell_dd = defaultDrops(count.data, expected = 5000)\n    eout = emptyDrops(count.data, lower = 200)\n    eout\\$FDR[is.na(eout\\$FDR)] = 1\n    iscell_ed = eout\\$FDR<=0.01\n    meta = data.frame(row.names = paste0(bc\\$V1,\"-1\"),\n                      iscell_dd = iscell_dd, iscell_ed = iscell_ed)\n\n    # plot rankings for number of UMI\n    br.out <- barcodeRanks(count.data)\n    pdf(\"${params.samplename}_UMIrank.pdf\", height = 5, width = 5, useDingbats = F)\n    plot(br.out\\$rank, br.out\\$total, log=\"xy\", xlab=\"Rank\", ylab=\"Total\")\n    o <- order(br.out\\$rank)\n    lines(br.out\\$rank[o], br.out\\$fitted[o], col=\"red\")\n    abline(h=metadata(br.out)\\$knee, col=\"dodgerblue\", lty=2)\n    abline(h=metadata(br.out)\\$inflection, col=\"forestgreen\", lty=2)\n    legend(\"bottomleft\", lty=2, col=c(\"dodgerblue\", \"forestgreen\"),\n        legend=c(\"knee\", \"inflection\"))\n    dev.off()\n\n    # UMI duplication\n    umi = read.table(\"${umic}\", sep = \"\\t\", header = F, stringsAsFactors = F)\n    sumUMI = c()\n    sumi = sum(umi\\$V4)\n    for(i in 0:250){ sumUMI = c(sumUMI, sum(umi\\$V4[umi\\$V4>i])/sumi) }\n    pdf(\"${params.samplename}_UMIduplication.pdf\", height = 3.5, width = 7, useDingbats = F)\n    par(mfrow = c(1,2))\n    plot(sumUMI, ylim = c(0,1), pch = 20, col = \"grey30\", ylab = \"% of total reads\",\n         xlab = \"More than xx UMI\", main = \"${params.samplename}\")\n    diffUMI = sumUMI[-length(sumUMI)] - sumUMI[-1]\n    plot(diffUMI, ylim = c(0,0.2), pch = 20, col = \"grey30\", ylab = \"Change in % of total reads\",\n         xlab = \"More than xx UMI\", main = \"${params.samplename}\")\n    dev.off()\n\n    # create Seurat object\n    ## we're only keeping what might potentially be a cell (by DD or ED)\n    srat = CreateSeuratObject(counts = count.data[,iscell_dd | iscell_ed],\n                              meta.data = meta[iscell_dd | iscell_ed,])\n    amb_prop = estimateAmbience(count.data)[rownames(srat@assays\\$RNA@meta.features)]\n    srat@assays\\$RNA@meta.features = data.frame(row.names = rownames(srat@assays\\$RNA@meta.features),\n                                                \"ambient_prop\" = amb_prop)\n\n    # get MT% (genes curated from NCBI chrMT genes)\n    mtgenes = c(\"COX1\", \"COX2\", \"COX3\", \"ATP6\", \"ND1\", \"ND5\", \"CYTB\", \"ND2\", \"ND4\",\n                \"ATP8\", \"MT-CO1\", \"COI\", \"LOC9829747\")\n    mtgenes = c(mtgenes, paste0(\"MT\", mtgenes), paste0(\"MT-\", mtgenes))\n    mtgenes = mtgenes[mtgenes %in% g[,1]]\n    srat = PercentageFeatureSet(srat, col.name = \"percent.mt\", assay = \"RNA\",\n                                features = mtgenes)\n\n    saveRDS(srat, file = \"${params.samplename}_srat.RDS\")\n\n    \"\"\"",
        "nb_lignes_script": 66,
        "language_script": "--vanilla",
        "tools": [],
        "tools_url": [],
        "tools_dico": [],
        "inputs": [
            "kallisto_count",
            "kallisto_umic"
        ],
        "nb_inputs": 2,
        "outputs": [],
        "nb_outputs": 0,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir \"${params.outdir}/${params.samplename}\""
        ],
        "when": "",
        "stub": ""
    },
    "makeSeuratVisium": {
        "name_process": "makeSeuratVisium",
        "string_process": "\nprocess makeSeuratVisium {\n\n    storeDir \"${params.outdir}/${params.samplename}\"\n\n    input:\n    file outbus from kallisto_count\n    file umic from kallisto_umic.collect()\n\n    output:\n    file \"UMIrank.pdf\"\n    file \"UMIduplication.pdf\"\n    file \"srat.RDS\"\n\n    when: params.protocol=='visiumv1'\n\n    script:\n    \"\"\"\n    ml load r/3.6.2-foss-2018b\n    cp -r ${outbus}/mock ${outbus}/genecounts.mtx ${outbus}/genecounts.genes.txt ${outbus}/genecounts.barcodes.txt .\n    cp $baseDir/scripts/make_SeuratObj_Visium.R ./make_SeuratObj_Visium.R\n    Rscript make_SeuratObj_Visium.R\n\n    \"\"\"\n\n}",
        "nb_lignes_process": 24,
        "string_script": "    \"\"\"\n    ml load r/3.6.2-foss-2018b\n    cp -r ${outbus}/mock ${outbus}/genecounts.mtx ${outbus}/genecounts.genes.txt ${outbus}/genecounts.barcodes.txt .\n    cp $baseDir/scripts/make_SeuratObj_Visium.R ./make_SeuratObj_Visium.R\n    Rscript make_SeuratObj_Visium.R\n\n    \"\"\"",
        "nb_lignes_script": 6,
        "language_script": "bash",
        "tools": [
            "MLC"
        ],
        "tools_url": [
            "https://bio.tools/MLC"
        ],
        "tools_dico": [
            {
                "name": "MLC",
                "uri": "https://bio.tools/MLC",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarray experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Gene expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3518",
                            "term": "Microarrays"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0203",
                            "term": "Expression"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Transcriptome profiling"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA-Seq analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small RNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Small-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "Whole transcriptome shotgun sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "RNA sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3170",
                            "term": "WTSS"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Expression correlation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted correlation network analysis"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Enrichment"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3501",
                                    "term": "Over-representation analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3463",
                                    "term": "Co-expression analysis"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "WGCNA"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3766",
                                    "term": "Weighted gene co-expression network analysis"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Metric Learning on Expression Data for Gene Function Prediction.",
                "homepage": "http://www.github.com/stamakro/MLC"
            }
        ],
        "inputs": [
            "kallisto_count",
            "kallisto_umic"
        ],
        "nb_inputs": 2,
        "outputs": [],
        "nb_outputs": 0,
        "name_workflow": "lengfei5__nf_visium_kallisto",
        "directive": [
            "storeDir \"${params.outdir}/${params.samplename}\""
        ],
        "when": "",
        "stub": ""
    }
}