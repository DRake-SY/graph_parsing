{
    "filter_variants": {
        "name_process": "filter_variants",
        "string_process": "\nprocess filter_variants {\n\ttag \"${indiv_id}:${cell_type}\"\n\tmodule ' bedops/2.4.40-typical'\n\n\tpublishDir params.outdir, mode: 'symlink'\n\n\tinput:\n\tset val(indiv_id), val(cell_type), val(hotspots_file) from INDIV_CELL_TYPE\n\t\n\tfile genotype_file from file(params.genotype_file)\n\tfile '*' from file(\"${params.genotype_file}.csi\")\n\t\n\tval min_DP from params.min_DP\n\tval min_AD from params.min_AD\n\tval min_GQ from params.min_GQ\n\n\toutput:\n\tfile(\"${indiv_id}_${cell_type}.bed.gz\")\n\tfile(\"${indiv_id}_${cell_type}.bed.gz.tbi\")\n\n\tscript:\n\t\"\"\"\n\tbcftools query \\\n\t\t-s ${indiv_id} \\\n\t\t-i'GT=\"alt\"' \\\n\t\t-f'%CHROM\\\\t%POS0\\\\t%POS\\\\t%CHROM:%POS:%REF:%ALT\\\\t%REF\\\\t%ALT\\\\t[%GT\\\\t%GQ\\\\t%DP\\\\t%AD{0}\\\\t%AD{1}]\\\\n' \\\n\t\t${genotype_file} \\\n\t| awk -v OFS=\"\\\\t\" \\\n\t\t-v min_GQ=${min_GQ} -v min_AD=${min_AD} -v min_DP=${min_DP}\\\n\t\t'\\$8<min_GQ { next; } \\$9<min_DP { next; }\\\n\t\t\t(\\$7==\"0/1\" || \\$7==\"1/0\" || \\$7==\"0|1\" || \\$7==\"1|0\") && (\\$10<min_AD || \\$11<min_AD) { \\\n\t\t\t\tnext; \\\n\t\t\t} \\\n\t\t\t{ print; }' \\\n\t| sort-bed - \\\n\t| grep -v chrX | grep -v chrY | grep -v chrM | grep -v _random | grep -v _alt | grep -v chrUn \\\n\t| bedops -e 1 - ${hotspots_file} \\\n\t| bgzip -c > ${indiv_id}_${cell_type}.bed.gz\n\n\ttabix -p bed ${indiv_id}_${cell_type}.bed.gz\n\t\"\"\"\n}",
        "nb_lignes_process": 41,
        "string_script": "\t\"\"\"\n\tbcftools query \\\n\t\t-s ${indiv_id} \\\n\t\t-i'GT=\"alt\"' \\\n\t\t-f'%CHROM\\\\t%POS0\\\\t%POS\\\\t%CHROM:%POS:%REF:%ALT\\\\t%REF\\\\t%ALT\\\\t[%GT\\\\t%GQ\\\\t%DP\\\\t%AD{0}\\\\t%AD{1}]\\\\n' \\\n\t\t${genotype_file} \\\n\t| awk -v OFS=\"\\\\t\" \\\n\t\t-v min_GQ=${min_GQ} -v min_AD=${min_AD} -v min_DP=${min_DP}\\\n\t\t'\\$8<min_GQ { next; } \\$9<min_DP { next; }\\\n\t\t\t(\\$7==\"0/1\" || \\$7==\"1/0\" || \\$7==\"0|1\" || \\$7==\"1|0\") && (\\$10<min_AD || \\$11<min_AD) { \\\n\t\t\t\tnext; \\\n\t\t\t} \\\n\t\t\t{ print; }' \\\n\t| sort-bed - \\\n\t| grep -v chrX | grep -v chrY | grep -v chrM | grep -v _random | grep -v _alt | grep -v chrUn \\\n\t| bedops -e 1 - ${hotspots_file} \\\n\t| bgzip -c > ${indiv_id}_${cell_type}.bed.gz\n\n\ttabix -p bed ${indiv_id}_${cell_type}.bed.gz\n\t\"\"\"",
        "nb_lignes_script": 19,
        "language_script": "bash",
        "tools": [
            "BCFtools",
            "NextSV",
            "Bedops"
        ],
        "tools_url": [
            "https://bio.tools/bcftools",
            "https://bio.tools/nextsv",
            "https://bio.tools/bedops"
        ],
        "tools_dico": [
            {
                "name": "BCFtools",
                "uri": "https://bio.tools/bcftools",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3516",
                            "term": "Genotyping experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0199",
                            "term": "Genetic variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS study"
                        },
                        {
                            "uri": "http://edamontology.org/topic_2885",
                            "term": "DNA polymorphism"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0199",
                            "term": "DNA variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "Genome-wide association study"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Data handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3227",
                                    "term": "Variant calling"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Utility operation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File processing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Report handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3227",
                                    "term": "Variant mapping"
                                }
                            ]
                        ],
                        "input": [
                            {
                                "uri": "http://edamontology.org/data_3498",
                                "term": "Sequence variations"
                            }
                        ],
                        "output": [
                            {
                                "uri": "http://edamontology.org/data_3498",
                                "term": "Sequence variations"
                            }
                        ]
                    }
                ],
                "description": "Set of utilities that manipulate variant calls in the Variant Call Format (VCF) and its binary counterpart BCF. All commands work transparently with both VCFs and BCFs, both uncompressed and BGZF-compressed.",
                "homepage": "http://www.htslib.org/"
            },
            {
                "name": "NextSV",
                "uri": "https://bio.tools/nextsv",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3175",
                            "term": "Structural variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3168",
                            "term": "Sequencing"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3175",
                            "term": "Genomic structural variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3175",
                            "term": "DNA structural variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3168",
                            "term": "DNA-Seq"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3228",
                                    "term": "Structural variation detection"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3228",
                                    "term": "Structural variation discovery"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "A meta SV caller and a computational pipeline to perform SV calling from low coverage long-read sequencing data. It integrates three aligners and three SV callers and generates two integrated call sets (sensitive/stringent) for different analysis purpose.",
                "homepage": "http://github.com/Nextomics/NextSV"
            },
            {
                "name": "Bedops",
                "uri": "https://bio.tools/bedops",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_0077",
                            "term": "Nucleic acids"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0160",
                            "term": "Sequence sites, features and motifs"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0077",
                            "term": "Nucleic acid bioinformatics"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0077",
                            "term": "Nucleic acid informatics"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0361",
                                    "term": "Sequence annotation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2121",
                                    "term": "Sequence file editing"
                                }
                            ],
                            []
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "BEDOPS is an open-source command-line toolkit that performs efficient and scalable Boolean and other set operations, statistical calculations, archiving, conversion and other management of genomic data of arbitrary scale. Tasks can be easily split by chromosome for distributing whole-genome analyses across a computational cluster.",
                "homepage": "https://bedops.readthedocs.io/en/latest/"
            }
        ],
        "inputs": [
            "INDIV_CELL_TYPE",
            "params",
            "params",
            "params"
        ],
        "nb_inputs": 4,
        "outputs": [],
        "nb_outputs": 0,
        "name_workflow": "jvierstra__nf-genotyping",
        "directive": [
            "tag \"${indiv_id}:${cell_type}\"",
            "module ' bedops/2.4.40-typical'",
            "publishDir params.outdir, mode: 'symlink'"
        ],
        "when": "",
        "stub": ""
    },
    "merge_bamfiles": {
        "name_process": "merge_bamfiles",
        "string_process": "\nprocess merge_bamfiles {\n\ttag \"${indiv_id}\"\n\n\tcpus 2\n\n\tpublishDir params.outdir + '/merged', mode: 'symlink'\n\n\tinput:\n\tset val(indiv_id), val(bam_files) from SAMPLES_AGGREGATIONS_MERGE\n\n\toutput:\n\tset val(indiv_id), file(\"${indiv_id}.bam\"), file(\"${indiv_id}.bam.bai\") into INDIV_MERGED_FILES, INDIV_MERGED_LIST\n\n\tscript:\n\t\"\"\"\n\tsamtools merge -f -@${task.cpus} ${indiv_id}.bam ${bam_files}\n\tsamtools index ${indiv_id}.bam\n\t\"\"\"\n}",
        "nb_lignes_process": 18,
        "string_script": "\t\"\"\"\n\tsamtools merge -f -@${task.cpus} ${indiv_id}.bam ${bam_files}\n\tsamtools index ${indiv_id}.bam\n\t\"\"\"",
        "nb_lignes_script": 3,
        "language_script": "bash",
        "tools": [
            "SAMtools"
        ],
        "tools_url": [
            "https://bio.tools/samtools"
        ],
        "tools_dico": [
            {
                "name": "SAMtools",
                "uri": "https://bio.tools/samtools",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3168",
                            "term": "Sequencing"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3325",
                            "term": "Rare diseases"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0080",
                            "term": "Sequence analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0102",
                            "term": "Mapping"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_3168",
                            "term": "DNA-Seq"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3325",
                            "term": "https://en.wikipedia.org/wiki/Rare_disease"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0080",
                            "term": "Sequences"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3096",
                                    "term": "Editing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0337",
                                    "term": "Visualisation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_1812",
                                    "term": "Parsing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0335",
                                    "term": "Formatting"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0227",
                                    "term": "Indexing"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_0337",
                                    "term": "Data visualisation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0337",
                                    "term": "Rendering"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_1812",
                                    "term": "Data loading"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_1812",
                                    "term": "Loading"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0335",
                                    "term": "Format conversion"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0335",
                                    "term": "File reformatting"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0335",
                                    "term": "File format conversion"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0335",
                                    "term": "File formatting"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0335",
                                    "term": "Reformatting"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0227",
                                    "term": "Data indexing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0227",
                                    "term": "Database indexing"
                                }
                            ]
                        ],
                        "input": [
                            {
                                "uri": "http://edamontology.org/data_0924",
                                "term": "Sequence trace"
                            }
                        ],
                        "output": [
                            {
                                "uri": "http://edamontology.org/data_0924",
                                "term": "Sequence trace"
                            }
                        ]
                    }
                ],
                "description": "A software package with various utilities for processing alignments in the SAM format, including variant calling and alignment viewing.",
                "homepage": "http://www.htslib.org/"
            }
        ],
        "inputs": [
            "SAMPLES_AGGREGATIONS_MERGE"
        ],
        "nb_inputs": 1,
        "outputs": [
            "INDIV_MERGED_FILES",
            "INDIV_MERGED_LIST"
        ],
        "nb_outputs": 2,
        "name_workflow": "jvierstra__nf-genotyping",
        "directive": [
            "tag \"${indiv_id}\"",
            "cpus 2",
            "publishDir params.outdir + '/merged', mode: 'symlink'"
        ],
        "when": "",
        "stub": ""
    },
    "create_genome_chunks": {
        "name_process": "create_genome_chunks",
        "string_process": "\nprocess create_genome_chunks {\n\texecutor 'local'\n\n\tinput:\n\tfile chrom_sizes from file(genome_chrom_sizes_file)\n\tval chunksize from params.chunksize\n\n\toutput:\n\tstdout into GENOME_CHUNKS\n\n\tscript:\n\t\"\"\"\n\tcat ${chrom_sizes} \\\n  \t| awk -v step=${chunksize} -v OFS=\"\\t\" \\\n\t\t'{ \\\n\t\t\tfor(i=step; i<=\\$2; i+=step) { \\\n\t\t\t\tprint \\$1\":\"i-step+1\"-\"i; \\\n\t\t\t} \\\n\t\t\tprint \\$1\":\"i-step+1\"-\"\\$2; \\\n\t\t}' \\\n\t\"\"\"\n}",
        "nb_lignes_process": 21,
        "string_script": "\t\"\"\"\n\tcat ${chrom_sizes} \\\n  \t| awk -v step=${chunksize} -v OFS=\"\\t\" \\\n\t\t'{ \\\n\t\t\tfor(i=step; i<=\\$2; i+=step) { \\\n\t\t\t\tprint \\$1\":\"i-step+1\"-\"i; \\\n\t\t\t} \\\n\t\t\tprint \\$1\":\"i-step+1\"-\"\\$2; \\\n\t\t}' \\\n\t\"\"\"",
        "nb_lignes_script": 9,
        "language_script": "bash",
        "tools": [],
        "tools_url": [],
        "tools_dico": [],
        "inputs": [
            "params"
        ],
        "nb_inputs": 1,
        "outputs": [
            "GENOME_CHUNKS"
        ],
        "nb_outputs": 1,
        "name_workflow": "jvierstra__nf-genotyping",
        "directive": [
            "executor 'local'"
        ],
        "when": "",
        "stub": ""
    },
    "call_genotypes": {
        "name_process": "call_genotypes",
        "string_process": "\nprocess call_genotypes {\n\ttag \"Region: ${region}\"\n\t\n\tscratch true\n\tcpus 2\n\n\tinput:\n\tfile genome_fasta from file(genome_fasta_file)\n\t\n\tfile dbsnp_file from file(params.dbsnp_file)\n\tfile dbsnp_index_file from file(\"${params.dbsnp_file}.tbi\")\n \t\n\tval min_DP from params.min_DP\n\tval min_SNPQ from params.min_SNPQ\n\tval min_GQ from params.min_GQ\n\tval hwe_cutoff from params.hwe_cutoff\n\n\tval region from GENOME_CHUNKS_MAP\n\tfile '*' from INDIV_MERGED_ALL_FILES.collect()\n\tfile 'sample_indiv_map.tsv' from INDIV_MERGED_SAMPLE_MAP_FILE \n\n\toutput:\n\tfile '*filtered.annotated.vcf.gz*' into GENOME_CHUNKS_VCF\n\n\tscript:\n\t\"\"\"\n\tcut -f1 sample_indiv_map.tsv > samples.txt\n\tcut -f2 sample_indiv_map.tsv > filelist.txt\n\n\tbcftools mpileup \\\n\t\t--regions ${region} \\\n\t\t--fasta-ref ${genome_fasta} \\\n\t\t--redo-BAQ \\\n\t\t--adjust-MQ 50 \\\n\t\t--gap-frac 0.05 \\\n\t\t--max-depth 10000 --max-idepth 200000 \\\n\t\t--annotate FORMAT/DP,FORMAT/AD \\\n\t\t--bam-list filelist.txt \\\n\t\t--output-type u \\\n\t| bcftools call \\\n\t\t--threads ${task.cpus} \\\n\t\t--keep-alts \\\n\t\t--multiallelic-caller \\\n\t\t--format-fields GQ \\\n\t\t--output-type v \\\n\t| bcftools filter \\\n\t\t-i\"INFO/DP>=${min_DP}\" \\\n\t\t--output-type z - \\\n\t> ${region}.vcf.gz\n\n\tbcftools index ${region}.vcf.gz\n\n\tbcftools reheader \\\n\t\t-s samples.txt \\\n\t \t${region}.vcf.gz \\\n\t| bcftools norm \\\n\t\t--threads ${task.cpus} \\\n\t\t--check-ref w \\\n\t\t-m - \\\n\t\t--fasta-ref ${genome_fasta} \\\n\t| bcftools filter \\\n\t\t-i\"QUAL>=${min_SNPQ} & FORMAT/GQ>=${min_GQ} & FORMAT/DP>=${min_DP}\" \\\n\t\t--SnpGap 3 --IndelGap 10 --set-GTs . \\\n\t| bcftools view \\\n\t\t-i'GT=\"alt\"' --trim-alt-alleles \\\n\t| bcftools annotate -x ^INFO/DP \\\n\t| bcftools +fill-tags -- -t all \\\n\t| bcftools filter --output-type z -e\"INFO/HWE<${hwe_cutoff}\" \\\n\t> ${region}.filtered.vcf.gz\n\n\tbcftools index ${region}.filtered.vcf.gz\n\n\tbcftools annotate \\\n\t\t-r ${region} \\\n\t\t-a ${dbsnp_file} \\\n\t\t--columns ID,CAF,TOPMED \\\n\t\t--output-type z \\\n  \t\t${region}.filtered.vcf.gz \\\n\t> ${region}.filtered.annotated.vcf.gz\n\n\tbcftools index ${region}.filtered.annotated.vcf.gz\t\t\n\t\"\"\"\n}",
        "nb_lignes_process": 82,
        "string_script": "\t\"\"\"\n\tcut -f1 sample_indiv_map.tsv > samples.txt\n\tcut -f2 sample_indiv_map.tsv > filelist.txt\n\n\tbcftools mpileup \\\n\t\t--regions ${region} \\\n\t\t--fasta-ref ${genome_fasta} \\\n\t\t--redo-BAQ \\\n\t\t--adjust-MQ 50 \\\n\t\t--gap-frac 0.05 \\\n\t\t--max-depth 10000 --max-idepth 200000 \\\n\t\t--annotate FORMAT/DP,FORMAT/AD \\\n\t\t--bam-list filelist.txt \\\n\t\t--output-type u \\\n\t| bcftools call \\\n\t\t--threads ${task.cpus} \\\n\t\t--keep-alts \\\n\t\t--multiallelic-caller \\\n\t\t--format-fields GQ \\\n\t\t--output-type v \\\n\t| bcftools filter \\\n\t\t-i\"INFO/DP>=${min_DP}\" \\\n\t\t--output-type z - \\\n\t> ${region}.vcf.gz\n\n\tbcftools index ${region}.vcf.gz\n\n\tbcftools reheader \\\n\t\t-s samples.txt \\\n\t \t${region}.vcf.gz \\\n\t| bcftools norm \\\n\t\t--threads ${task.cpus} \\\n\t\t--check-ref w \\\n\t\t-m - \\\n\t\t--fasta-ref ${genome_fasta} \\\n\t| bcftools filter \\\n\t\t-i\"QUAL>=${min_SNPQ} & FORMAT/GQ>=${min_GQ} & FORMAT/DP>=${min_DP}\" \\\n\t\t--SnpGap 3 --IndelGap 10 --set-GTs . \\\n\t| bcftools view \\\n\t\t-i'GT=\"alt\"' --trim-alt-alleles \\\n\t| bcftools annotate -x ^INFO/DP \\\n\t| bcftools +fill-tags -- -t all \\\n\t| bcftools filter --output-type z -e\"INFO/HWE<${hwe_cutoff}\" \\\n\t> ${region}.filtered.vcf.gz\n\n\tbcftools index ${region}.filtered.vcf.gz\n\n\tbcftools annotate \\\n\t\t-r ${region} \\\n\t\t-a ${dbsnp_file} \\\n\t\t--columns ID,CAF,TOPMED \\\n\t\t--output-type z \\\n  \t\t${region}.filtered.vcf.gz \\\n\t> ${region}.filtered.annotated.vcf.gz\n\n\tbcftools index ${region}.filtered.annotated.vcf.gz\t\t\n\t\"\"\"",
        "nb_lignes_script": 56,
        "language_script": "bash",
        "tools": [
            "BCFtools",
            "DP2"
        ],
        "tools_url": [
            "https://bio.tools/bcftools",
            "https://bio.tools/dp2"
        ],
        "tools_dico": [
            {
                "name": "BCFtools",
                "uri": "https://bio.tools/bcftools",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3516",
                            "term": "Genotyping experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0199",
                            "term": "Genetic variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS study"
                        },
                        {
                            "uri": "http://edamontology.org/topic_2885",
                            "term": "DNA polymorphism"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0199",
                            "term": "DNA variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "Genome-wide association study"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Data handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3227",
                                    "term": "Variant calling"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Utility operation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File processing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Report handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3227",
                                    "term": "Variant mapping"
                                }
                            ]
                        ],
                        "input": [
                            {
                                "uri": "http://edamontology.org/data_3498",
                                "term": "Sequence variations"
                            }
                        ],
                        "output": [
                            {
                                "uri": "http://edamontology.org/data_3498",
                                "term": "Sequence variations"
                            }
                        ]
                    }
                ],
                "description": "Set of utilities that manipulate variant calls in the Variant Call Format (VCF) and its binary counterpart BCF. All commands work transparently with both VCFs and BCFs, both uncompressed and BGZF-compressed.",
                "homepage": "http://www.htslib.org/"
            },
            {
                "name": "DP2",
                "uri": "https://bio.tools/dp2",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3382",
                            "term": "Imaging"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0611",
                            "term": "Electron microscopy"
                        }
                    ],
                    []
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_3443",
                                    "term": "Image analysis"
                                }
                            ],
                            []
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "Software for segmentation of 3D structures contained in 3D microscopy.",
                "homepage": "https://sites.google.com/site/imagecrowdseg/home"
            }
        ],
        "inputs": [
            "params",
            "params",
            "params",
            "params",
            "GENOME_CHUNKS_MAP",
            "INDIV_MERGED_ALL_FILES",
            "INDIV_MERGED_SAMPLE_MAP_FILE"
        ],
        "nb_inputs": 7,
        "outputs": [
            "GENOME_CHUNKS_VCF"
        ],
        "nb_outputs": 1,
        "name_workflow": "jvierstra__nf-genotyping",
        "directive": [
            "tag \"Region: ${region}\"",
            "scratch true",
            "cpus 2"
        ],
        "when": "",
        "stub": ""
    },
    "merge_vcfs": {
        "name_process": "merge_vcfs",
        "string_process": "\nprocess merge_vcfs {\n\n\tscratch true\n\tpublishDir params.outdir + '/genotypes', mode: 'symlink'\n\n\tinput:\n\tfile '*' from GENOME_CHUNKS_VCF.collect()\n\tfile genome_fasta_ancestral from file(params.genome_ancestral_fasta_file)\n\n\toutput:\n\tfile 'all.filtered.vcf.gz*'\n\tset file('all.filtered.snps.annotated.vcf.gz'), file('all.filtered.snps.annotated.vcf.gz.csi') into FILTERED_SNPS_VCF\n    file \"plink.*\"\n    \n\tscript:\n\t\"\"\"\n\t# Concatenate files\n\tls *.filtered.annotated.vcf.gz > files.txt\n\tcat files.txt | tr \":-\" \"\\\\t\" | tr \".\" \"\\\\t\" | cut -f1-3 | paste - files.txt | sort-bed - | awk '{ print \\$NF; }' > mergelist.txt\n\n\tbcftools concat \\\n\t\t--output-type z \\\n\t\t-f mergelist.txt \\\n\t> all.filtered.vcf.gz\n\t\n\tbcftools index all.filtered.vcf.gz\n\t\n\t# Output only SNPs\n\tbcftools view \\\n\t\t-m2 -M2 -v snps \\\n\t\t--output-type z \\\n\t\tall.filtered.vcf.gz \\\n\t> all.filtered.snps.vcf.gz\n\t\n\tbcftools index all.filtered.snps.vcf.gz\t\n\n\t# Annotate ancestral allele\n\t\n\techo \"##INFO=<ID=AA,Number=1,Type=String,Description=\\\"Inferred ancestral allele -- EPO/PECAN alignments\\\">\" > header.txt\n\n\t# Contigs with ancestral allele information\n\tfaidx -i chromsizes ${genome_fasta_ancestral} | cut -f1 > chroms.txt\n\t\n\t# Get SNPs in BED-format; remove contigs with no FASTA sequence\n\tbcftools query  -f \"%CHROM\\t%POS0\\t%POS\\t%REF\\t%ALT\\n\" all.filtered.snps.vcf.gz \\\n\t| grep -w -f chroms.txt \\\n\t> all.filtered.snps.bed\n\n\t# Get ancestral allele from FASTA file and make a TABIX file\n\tfaidx -i transposed \\\n\t\t-b all.filtered.snps.bed \\\n\t\t${genome_fasta_ancestral} \\\n\t| paste - all.filtered.snps.bed\t\\\n\t| awk -v OFS=\"\\t\" '{ print \\$5, \\$7, \\$4; }' \\\n\t| bgzip -c > all.filtered.snps.ancestral.tab.gz\n\n\ttabix -b 2 -e -2 all.filtered.snps.ancestral.tab.gz\n\n\t# Annotate VCF\n\tbcftools annotate \\\n\t\t--output-type z \\\n\t\t-h header.txt \\\n\t\t-a all.filtered.snps.ancestral.tab.gz \\\n\t\t-c CHROM,POS,INFO/AA \\\n\t\tall.filtered.snps.vcf.gz \\\n\t> all.filtered.snps.annotated.vcf.gz\n\t\n\tbcftools index all.filtered.snps.annotated.vcf.gz\n    \n    \n    plink2 --make-bed \\\n    \t--output-chr chrM \\\n    \t--vcf all.filtered.snps.annotated.vcf.gz \\\n        --keep-allele-order \\\n    \t--snps-only \\\n        -allow-extra-chr \\\n    \t--out plink\n\n\t\"\"\"\n}",
        "nb_lignes_process": 79,
        "string_script": "\t\"\"\"\n\t# Concatenate files\n\tls *.filtered.annotated.vcf.gz > files.txt\n\tcat files.txt | tr \":-\" \"\\\\t\" | tr \".\" \"\\\\t\" | cut -f1-3 | paste - files.txt | sort-bed - | awk '{ print \\$NF; }' > mergelist.txt\n\n\tbcftools concat \\\n\t\t--output-type z \\\n\t\t-f mergelist.txt \\\n\t> all.filtered.vcf.gz\n\t\n\tbcftools index all.filtered.vcf.gz\n\t\n\t# Output only SNPs\n\tbcftools view \\\n\t\t-m2 -M2 -v snps \\\n\t\t--output-type z \\\n\t\tall.filtered.vcf.gz \\\n\t> all.filtered.snps.vcf.gz\n\t\n\tbcftools index all.filtered.snps.vcf.gz\t\n\n\t# Annotate ancestral allele\n\t\n\techo \"##INFO=<ID=AA,Number=1,Type=String,Description=\\\"Inferred ancestral allele -- EPO/PECAN alignments\\\">\" > header.txt\n\n\t# Contigs with ancestral allele information\n\tfaidx -i chromsizes ${genome_fasta_ancestral} | cut -f1 > chroms.txt\n\t\n\t# Get SNPs in BED-format; remove contigs with no FASTA sequence\n\tbcftools query  -f \"%CHROM\\t%POS0\\t%POS\\t%REF\\t%ALT\\n\" all.filtered.snps.vcf.gz \\\n\t| grep -w -f chroms.txt \\\n\t> all.filtered.snps.bed\n\n\t# Get ancestral allele from FASTA file and make a TABIX file\n\tfaidx -i transposed \\\n\t\t-b all.filtered.snps.bed \\\n\t\t${genome_fasta_ancestral} \\\n\t| paste - all.filtered.snps.bed\t\\\n\t| awk -v OFS=\"\\t\" '{ print \\$5, \\$7, \\$4; }' \\\n\t| bgzip -c > all.filtered.snps.ancestral.tab.gz\n\n\ttabix -b 2 -e -2 all.filtered.snps.ancestral.tab.gz\n\n\t# Annotate VCF\n\tbcftools annotate \\\n\t\t--output-type z \\\n\t\t-h header.txt \\\n\t\t-a all.filtered.snps.ancestral.tab.gz \\\n\t\t-c CHROM,POS,INFO/AA \\\n\t\tall.filtered.snps.vcf.gz \\\n\t> all.filtered.snps.annotated.vcf.gz\n\t\n\tbcftools index all.filtered.snps.annotated.vcf.gz\n    \n    \n    plink2 --make-bed \\\n    \t--output-chr chrM \\\n    \t--vcf all.filtered.snps.annotated.vcf.gz \\\n        --keep-allele-order \\\n    \t--snps-only \\\n        -allow-extra-chr \\\n    \t--out plink\n\n\t\"\"\"",
        "nb_lignes_script": 63,
        "language_script": "bash",
        "tools": [
            "BCFtools",
            "pyfaidx"
        ],
        "tools_url": [
            "https://bio.tools/bcftools",
            "https://bio.tools/pyfaidx"
        ],
        "tools_dico": [
            {
                "name": "BCFtools",
                "uri": "https://bio.tools/bcftools",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_3516",
                            "term": "Genotyping experiment"
                        },
                        {
                            "uri": "http://edamontology.org/topic_0199",
                            "term": "Genetic variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS study"
                        },
                        {
                            "uri": "http://edamontology.org/topic_2885",
                            "term": "DNA polymorphism"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0199",
                            "term": "DNA variation"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS analysis"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "GWAS"
                        },
                        {
                            "uri": "http://edamontology.org/topic_3517",
                            "term": "Genome-wide association study"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Data handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3227",
                                    "term": "Variant calling"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Utility operation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File processing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Report handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_3227",
                                    "term": "Variant mapping"
                                }
                            ]
                        ],
                        "input": [
                            {
                                "uri": "http://edamontology.org/data_3498",
                                "term": "Sequence variations"
                            }
                        ],
                        "output": [
                            {
                                "uri": "http://edamontology.org/data_3498",
                                "term": "Sequence variations"
                            }
                        ]
                    }
                ],
                "description": "Set of utilities that manipulate variant calls in the Variant Call Format (VCF) and its binary counterpart BCF. All commands work transparently with both VCFs and BCFs, both uncompressed and BGZF-compressed.",
                "homepage": "http://www.htslib.org/"
            },
            {
                "name": "pyfaidx",
                "uri": "https://bio.tools/pyfaidx",
                "topic": [
                    [
                        {
                            "uri": "http://edamontology.org/topic_0080",
                            "term": "Sequence analysis"
                        }
                    ],
                    [
                        {
                            "uri": "http://edamontology.org/topic_0080",
                            "term": "Sequences"
                        }
                    ]
                ],
                "function": [
                    {
                        "operation": [
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Data handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0227",
                                    "term": "Indexing"
                                }
                            ],
                            [
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Utility operation"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "File processing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_2409",
                                    "term": "Report handling"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0227",
                                    "term": "Data indexing"
                                },
                                {
                                    "uri": "http://edamontology.org/operation_0227",
                                    "term": "Database indexing"
                                }
                            ]
                        ],
                        "input": [],
                        "output": []
                    }
                ],
                "description": "This python module implements pure Python classes for indexing, retrieval, and in-place modification of FASTA files using a samtools compatible index.",
                "homepage": "https://pythonhosted.org/pyfaidx/"
            }
        ],
        "inputs": [
            "GENOME_CHUNKS_VCF"
        ],
        "nb_inputs": 1,
        "outputs": [
            "FILTERED_SNPS_VCF"
        ],
        "nb_outputs": 1,
        "name_workflow": "jvierstra__nf-genotyping",
        "directive": [
            "scratch true",
            "publishDir params.outdir + '/genotypes', mode: 'symlink'"
        ],
        "when": "",
        "stub": ""
    }
}